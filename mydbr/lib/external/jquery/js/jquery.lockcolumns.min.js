/*
 * jQuery jquery.lockcolumn.js
 * Copyright (c) 2015 myDBR.com
 *
 * http://myDBR.com
 *
*/
/*
 * jQuery jquery.lockcolumns.js
 * Copyright (c) 2015 myDBR.com
 *
 * http://myDBR.com
 *
 * Depends:
 *   - jQuery
*/

(function($,undefined){$.widget("mydbr.lockcolumns",{id:null,_is_visible:function(orig){var xscroll=window.scrollLeft||window.pageXOffset;return orig.position().left+parseInt(orig.css("margin-left"),10)>=xscroll},_get_position:function($o){var rel=0,ppos,pos={},$obj;pos.left=0;pos.top=0;$obj=$o;while($obj.offsetParent().css("position")!="relative"&&$obj.offsetParent().prop("tagName")!=="BODY"&&$obj.offsetParent().prop("tagName")!="HTML"){ppos=$obj.offsetParent().position();pos.top+=ppos.top;$obj=$obj.offsetParent();rel=1}if(!rel){pos.top=$o.position().top}pos.left=0;return pos},_set_position:function($table,$id,_this){var i,pos,lockcols,xscroll=window.scrollLeft||window.pageXOffset,yscroll=window.scrollTop||window.pageYOffset,pad;if(_this===undefined){_this=this}lockcols=parseInt($table.attr("data-lockcolumns"),10);pos=_this._get_position($table);pad=2;if($table.hasClass("compare")){pos.top-=2;pos.left-=2}if($table.hasClass("lockcolumns_fixedrow")){$table.find("tbody tr").each(function(idx){$id.find("tbody").find("tr").eq(idx).height($(this).outerHeight())})}if(_this._is_visible($table)){$id.css("display","none")}else{$id.css("display","table");$id.css("position","absolute").css("top",pos.top+pad+$table.find("caption").height()+"px").css("left",xscroll+pos.left+parseInt($table.css("margin-left"),10)+"px")}$id.find('thead:not(".tableFloatingHeader")').find("tr:last-child th").each(function(idx){$(this).attr("class",$table.find('thead:not(".tableFloatingHeader")').find("tr:last-child th").eq(idx).attr("class"))})},get_loc_table:function(el){return $(el).attr("id")+"_lockcol"},_init:function(){var $table=$(this.element),id,$id,lockcols,th_cols=[];if(!$table.hasClass("lockcolumns")){return false}id=this.get_loc_table($table);$id=$("#"+id);lockcols=parseInt($table.attr("data-lockcolumns"),10);if($id.length){$id.find("tbody").html("");$(this.element).find("tbody tr").clone().find("td:gt("+(lockcols-1)+")").remove().end().appendTo("#"+id+" tbody");$id.find("th:last-child:not(.noborder), td:last-child").css("border-right","1px solid #DDD");if(!this._is_visible($table)){$id.find("th,td").css("visibility","visible")}}this._set_position($table,$id);return false},_create:function(){var $table=$(this.element),$lock_head,id,$id,_this,set_position,i,cl,height,$headers,sort,whitespace,$row,classes;if($table.hasClass("lockcolumns_fixedrow")){$table.removeClass("lockcolumns");whitespace=$table.css("white-space");$table.addClass("lockcolumns");$table.css("white-space",whitespace)}lockcols=parseInt($table.attr("data-lockcolumns"),10);id=this.get_loc_table(this.element);$id=$("#"+id);if(!$id.length){classes=$table.attr("class").split(/\s+/);cl="";for(i=0;i<classes.length;i++){if(classes[i]=="compare"){cl+=" "+"compare_locked"}else{cl+=" "+classes[i]}}$table.after('<table style="z-index:20" id="'+id+'" data-base="'+$table.attr("id")+'" class="'+cl.trim()+'"><thead></thead><tbody></tbody></table>');$id=$("#"+id);$lock_head=$id.find("thead");$table.find('thead:not(".tableFloatingHeader") tr:not(:last-child)').each(function(index){height=cl="";if($(this).children().first().hasClass("cell_ct_top")){cl="cell_ct_top"}else if($(this).children().first().hasClass("cell_ct")){cl="cell_ct_middle"}else{cl="noborder"}height=' style="height:'+$(this).height()+"px"+'"';$lock_head.append('<tr class="row_header"'+height+'><th class="'+cl+'" colspan="'+lockcols+'">&nbsp;</th></tr>')});$row=$table.find('thead:not(".tableFloatingHeader") tr:last');height=' style="height:'+$row.height()+"px"+'"';$table.find('thead:not(".tableFloatingHeader") tr:last th:nth-child(-n+'+lockcols+")").clone().wrapAll('<tr class="row_header"'+height+"></tr>").parent().appendTo($lock_head)}$lock_head.find("tr:last-child th").each(function(){$(this).width($table.find("tbody tr:first td").eq(this.cellIndex).width())});$lock_head.find("tr:last-child th").click(function(e){click=jQuery.Event("click");if(e.shiftKey)click.shiftKey=true;$("#"+$(this).closest("table").attr("data-base")).find('thead:not(".tableFloatingHeader")').find("tr:last-child th:eq("+$(this).index()+")").trigger(click)});if($table.hasClass("stickyheader")){$id.stickyTableHeaders()}_this=this;set_position=this._set_position;$(window).on("resize scroll",function(e){set_position($table,$id,_this)})}})})(jQuery);
