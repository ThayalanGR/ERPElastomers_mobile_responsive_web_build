$(document).ready(function(){if(jQuery().tablesorter){$("table.sortable").tablesorter({widgets:["zebra"]})}$('input[name="authentication"]').click(function(){toggle_authentication(false)});$('input[name="sso_type"]').click(function(){var url,$sso_url;$sso_server_url=$("input[name=sso_server_url]");if($("input[name=sso_type]:checked").val()=="0"){$(".custom_sso_pref, .sso_secret_row").show();$(".google_sso_pref").hide()}else{$(".sso_secret_row").hide();$(".google_sso_pref").show()}url=$sso_server_url.val();$sso_server_url.val($sso_server_url.attr("data-url"));$sso_server_url.attr("data-url",url)});$("#oem_css_info").click(function(){$("#oem_css").toggle(300);return false});$("#cron_info").click(function(){$("#cron_info_txt").toggle(300);return false});if($('input[name="authentication"]').length>0){toggle_authentication(true)}$('select[name="mail_mailer"]').change(function(){if($(this).val()=="smtp"){$(".mail_smtp").slideDown(300)}else{$(".mail_smtp").slideUp(300)}});$("#test_ad").click(function(){ad_test()});$('.pquery_set input[name="querytype"]').change(function(){find_scroll_set()});$(".pquery_set .cb_cb").change(function(){checkbox_options(this)});$(".param_action #cancel").click(function(){ParameterActionCancel()});$(".param_action #code").click(function(){ParameterProcCode()});$(".param_action #addparameter").click(function(){ParameterEdit(1)});$(".param_action #updateparameter").click(function(){ParameterEdit(0)});find_scroll_set();$("select[name=scheduler_username]").select2({width:"250px",ajax:{url:"apps/user.php",dataType:"json",delay:250,data:function(params){return{getuser:params.term}},processResults:function(data){return{results:data}},cache:true},minimumInputLength:1});$(".param_in_use_count").click(function(){var name=$(this).parent().children().first().text();$.ajax({url:"index.php?a=param_in_use",data:{name:name,hdr:0},type:"get",success:function(data){$("#in_use_dlg").html(data);$("#in_use_dlg").dialog({modal:true,width:"auto",height:"auto"})}})});$("input[name=def_username]").each(function(){if($(this).attr("data-empty")=="1"){var timer,def_user=this;timer=setInterval(function(){$(def_user).val("");clearInterval(timer)},500)}});$("input[name=def_password]").each(function(){if($(this).attr("data-empty")=="1"){var timer,def_pass=this;timer=setInterval(function(){$(def_pass).val("");clearInterval(timer)},500)}});$("#adduser_div").click(function(){$("[name=login]").removeAttr("readonly").val("");$("[name=username]").val("");$("[name=email]").val("");$("[name=telephone]").val("");$("[name=password]").val("");$("[name=passwordC]").val("");$("[name=isadmin]").prop("checked",false);toggleEdit(0,"user");user_get_groups();$("#user_div").attr("title",$("#adduser").val()).dialog({modal:true,width:"auto",width:"1028px",minHeight:400,minWidth:650,open:function(event,ui){resize_user_group_in_dialog($(this).parent())},resize:function(event,ui){resize_user_group_in_dialog($(this).parent())}})});$("#adduser").click(function(){if(Users(1,"")){$("#user_div").dialog("close")}});$("#updateuser").click(function(){if(Users(2,"")){$("#user_div").dialog("close")}});$(document).on("click","#userlist .i_edit",function(){UserEdit(this);$("#user_div").attr("title",$("#updateuser").val()).dialog({modal:true,width:"1028px",minHeight:400,minWidth:650,open:function(event,ui){resize_user_group_in_dialog($(this).parent())},resize:function(event,ui){resize_user_group_in_dialog($(this).parent())}})});$(document).on("click","#userlist .i_show",function(){user_show_groups(this)})});function find_scroll_set(){var disable;disable=!($('.pquery_set input[name="querytype"]:checked').attr("id")=="popupquery");$(".pquery_set #pu_find").attr("disabled",disable);if(disable){$(".pquery_set #pu_find").prop("checked",false).next().addClass("disabled")}else{$(".pquery_set #pu_find").next().removeClass("disabled")}disable=!($('.pquery_set input[name="querytype"]:checked').attr("id")=="checkbox");$(".pquery_set #checkbox_sbs").attr("disabled",disable);$(".pquery_set #find").attr("disabled",disable);$(".pquery_set #scroll").attr("disabled",disable);$(".pquery_set #collapse").attr("disabled",disable);$(".pquery_set #cb_sbs").attr("disabled",disable);if(disable){$(".pquery_set #checkbox_sbs").prop("checked",false).next().addClass("disabled");$(".pquery_set #find").prop("checked",false).next().addClass("disabled");$(".pquery_set #scroll").prop("checked",false).next().addClass("disabled");$(".pquery_set #collapse").prop("checked",false).next().addClass("disabled")}else{$(".pquery_set #checkbox_sbs").next().removeClass("disabled");$(".pquery_set #find").next().removeClass("disabled");$(".pquery_set #scroll").next().removeClass("disabled");$(".pquery_set #collapse").next().removeClass("disabled")}disable=!($('.pquery_set input[name="querytype"]:checked').attr("id")=="radioquery");$(".pquery_set #radio_sbs").attr("disabled",disable);if(disable){$(".pquery_set #radio_sbs").prop("checked",false).next().addClass("disabled")}else{$(".pquery_set #radio_sbs").next().removeClass("disabled")}}function checkbox_options(obj){var sbs_checked=false;if($(obj).attr("id")=="checkbox_sbs"){sbs_checked=$(obj).is(":checked")}if(sbs_checked){$(".pquery_set #find").prop("checked",false);$(".pquery_set #scroll").prop("checked",false);$(".pquery_set #collapse").prop("checked",false)}else{$(".pquery_set #checkbox_sbs").prop("checked",false)}}function ad_test(){$.ajax({url:"apps/ad_test.php",data:{as:$('input[name="ad_account_suffix"]').val(),base_dn:$('input[name="ad_base_dn"]').val(),dc:$('input[name="ad_domain_controller"]').val(),user:$('input[name="ad_username"]').val(),pass:$('input[name="ad_password"]').val()},type:"post",success:function(data){alert(data)}})}function toggle_authentication(fast){var curr,auths=["auth_mydbr","auth_sso","auth_ad"];$.each(auths,function(index,value){var auth=$('input[name="authentication"]:checked').val();switch(auth){case"1":case"16":curr="";break;case"2":curr="auth_mydbr";break;case"4":curr="auth_sso";break;case"8":curr="auth_ad";break}if(curr==value){if(fast){$("."+value).show()}else{$("."+value).slideDown(300)}}else{if(fast){$("."+value).hide()}else{$("."+value).slideUp(300)}}})}function GoToAbout(){document.forms["admin"].app.value="about";if(document.getElementById("noheaders")){document.forms["admin"].noheaders.value=""}document.forms["admin"].validationRoutine.value="";document.forms["admin"].submit()}function GoToMain(){window.location.href="index.php"}function Pw_Check(checkb,valuef,defval){if(!document.getElementById(checkb).checked){document.getElementById(valuef).value=""}else{document.getElementById(valuef).value=defval}}function Pw_Val(checkb,valuef){if(parseInt(document.getElementById(valuef).value,10)>0){document.getElementById(checkb).checked=true}else{document.getElementById(checkb).checked=false;document.getElementById(valuef).value=""}}function toggleEdit(inAddMode,action){var addbutton=document.getElementById("add"+action),updatebutton=document.getElementById("update"+action);if(inAddMode==0){addbutton.style.display="";updatebutton.style.display="none"}else{addbutton.style.display="none";updatebutton.style.display=""}}function EditStyle(name,type,defref){document.forms["admin"].stylename.value=name;document.forms["admin"].styleold.value=name;document.getElementById("columnstyle").checked=type=="column";document.getElementById("rowstyle").checked=type!="column";document.forms["admin"].styledef.value=document.getElementById(defref).innerHTML.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");document.forms["admin"].stylename.disabled=true;toggleEdit(1,"style");if(!$("#styledef").visible(true)){$.scrollTo($("#styleedititle"),800,{easing:"easeInOutCubic"})}}function EditParam(name,type,options_str,queryref){var query,options=new Object;type=String(type);if(options_str!==""&&options_str!==null){options=JSON.parse(options_str)}else{options=JSON.parse("{}")}document.forms["admin"].parametername.value=name;document.forms["admin"].paramold.value=name;document.getElementById("popupquery").checked=type=="0";document.getElementById("radioquery").checked=type=="1";document.getElementById("autocomplete").checked=type=="2";document.getElementById("default").checked=type=="3";document.getElementById("checkbox").checked=$.inArray(type,["4","5","6","7","8","9","10","11"])>=0;document.getElementById("checkbox_sbs").checked=false;document.getElementById("scroll").checked=$.inArray(type,["5","6","9","10"])>=0;document.getElementById("find").checked=$.inArray(type,["5","7","9","11"])>=0;document.getElementById("collapse").checked=$.inArray(type,["8","9","10","11"])>=0;query=document.getElementById(queryref).innerHTML.substring(5);document.forms["admin"].parameterdef.value=query.substring(0,query.length-6).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");document.forms["admin"].parametername.disabled=true;if($(".pquery_set #popupquery").is(":checked")){$(".pquery_set .pu_cb").each(function(){$(this).prop("checked",options.hasOwnProperty($(this).val()))})}if($(".pquery_set #checkbox").is(":checked")){$(".pquery_set .cb_cb").each(function(){$(this).prop("checked",options.hasOwnProperty($(this).val()))})}if($(".pquery_set #radioquery").is(":checked")){$(".pquery_set .rb_cb").each(function(){$(this).prop("checked",options.hasOwnProperty($(this).val()))})}toggleEdit(1,"parameter");find_scroll_set();if(!$("#parameterdef").visible(true)){$.scrollTo($("input[name=parametername]"),800,{easing:"easeInOutCubic"})}}function ShowMap(){document.forms["admin"].app.value="showmap";if(document.forms["admin"].outputtype.value=="pdf"||document.forms["admin"].outputtype.value=="dot"){document.forms["admin"].noheaders.value=1}else{document.forms["admin"].noheaders.value=""}}function DownloadMap(){document.forms["admin"].app.value="dlmap";document.forms["admin"].submit()}function EditGroup(GroupID,Name){document.forms["admin"].actiontype.value="editgroup";document.forms["admin"].groupid.value=GroupID;document.forms["admin"].groupname.value=Name;document.forms["admin"].app.value="groups";document.forms["admin"].submit()}function chkAdminSumbit(){return document.forms["admin"].actiontype.value==""||document.forms["admin"].actiontype.value!="back"?false:true}function GroupEdit(isnew){if(document.forms["admin"].groupname.value==""){alert("Group name missing.")}else{if(isnew==1){document.forms["admin"].actiontype.value="newgroup"}else{document.forms["admin"].actiontype.value="updategroup"}document.forms["admin"].app.value="groups";document.forms["admin"].validationRoutine.value="groups_v";document.forms["admin"].submit()}}function chkStyleSumbit(){return document.forms["admin"].actiontype.value==""?false:true}function StyleEdit(isnew){var errors=new Array;if(document.forms["admin"].stylename.value==""){errors.push("group name")}if(document.forms["admin"].styledef.value==""){errors.push("definition")}if(errors.length>0){alert("Missing values: "+errors.join(","))}else{if(isnew==1){document.forms["admin"].actiontype.value="newstyle"}else{document.forms["admin"].actiontype.value="updatestyle"}document.forms["admin"].app.value="styles";document.forms["admin"].validationRoutine.value="styles_v";document.forms["admin"].submit()}}function random_string(){var chars="abcdefghiklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXTZ1234567890",string_length=25,token="",i,rnum;for(i=0;i<string_length;i++){rnum=Math.floor(Math.random()*chars.length);token+=chars.substring(rnum,rnum+1)}return token}function url_token_get(){document.forms["admin"].url_hash.value=random_string();return true}function sso_token_get(){document.forms["admin"].sso_token.value=random_string();return true}function chkParamSumbit(){return document.forms["admin"].actiontype.value==""?false:true}function ParameterEdit(isnew){var errors=new Array,selector,options;if(document.forms["admin"].parametername.value==""){errors.push("Parameter query name")}if(document.forms["admin"].parameterdef.value==""){errors.push("Query")}if(errors.length>0){alert("Missing values: "+errors.join(","))}else{if(isnew==1){document.forms["admin"].actiontype.value="newparameter"}else{document.forms["admin"].actiontype.value="updateparameter"}selector="";options=new Object;if($("#radioquery").is(":checked")){selector="rb_cb"}if($("#checkbox").is(":checked")){selector="cb_cb"}if($("#popupquery").is(":checked")){selector="pu_cb"}if(selector!=""){$("."+selector).each(function(){if($(this).is(":checked"))options[$(this).val()]=true})}$("input[name=paramoptions]").val(JSON.stringify(options));document.forms["admin"].app.value="pquery";document.forms["admin"].validationRoutine.value="param_query_v";document.forms["admin"].submit()}}function SaveNotif(id){document.forms["admin"].app.value="notifications";document.forms["admin"].validationRoutine.value="notifications_v";document.forms["admin"].submit()}function get_notif(){$.ajax({url:"apps/get_notif.php",data:{n:$("#notif").val()},type:"get",success:function(data){$("#lnotif").val(data)}})}function LicenseAdd(){if(document.forms["admin"].license.value==""){alert(mydbr_loc["MYDBR_LIC_MISSING"])}else{document.forms["admin"].app.value="license";document.forms["admin"].action.value="add";document.forms["admin"].validationRoutine.value="license_v";document.forms["admin"].submit()}}function LicenseDel(id){if(confirm(mydbr_loc["MYDBR_LIC_REM"])){document.forms["admin"].app.value="license";document.forms["admin"].licid.value=id;document.forms["admin"].action.value="del";document.forms["admin"].validationRoutine.value="license_v";document.forms["admin"].submit()}}function UserAdd(){if(document.forms["admin"].username.value==""){alert(mydbr_loc["MYDBR_USER_MISSING"])}else{document.forms["admin"].actiontype.value="addsearchuser";document.forms["admin"].app.value="groups";document.forms["admin"].validationRoutine.value="groups_v";document.forms["admin"].submit()}}function GroupDelete(GroupID,GroupName){if(confirm(sprintf(mydbr_loc["MYDBR_GROUP_REM"],GroupName))){document.forms["admin"].groupid.value=GroupID;document.forms["admin"].actiontype.value="delgroup";document.forms["admin"].app.value="groups";document.forms["admin"].validationRoutine.value="groups_v";document.forms["admin"].submit()}}function DeleteStyle(style){if(confirm(sprintf(mydbr_loc["MYDBR_STYLES_REM"],style))){document.forms["admin"].styleold.value=style;document.forms["admin"].actiontype.value="delstyle";document.forms["admin"].app.value="styles";document.forms["admin"].validationRoutine.value="styles_v";document.forms["admin"].submit()}}function DeleteParam(name){if(confirm(sprintf(mydbr_loc["MYDBR_PARAMQ_REM"],name))){document.forms["admin"].parametername.value="";document.forms["admin"].paramold.value=name;document.forms["admin"].actiontype.value="delparameter";document.forms["admin"].app.value="pquery";document.forms["admin"].validationRoutine.value="param_query_v";document.forms["admin"].submit()}}function ParameterProcCode(){var proc;proc=$("#parameterdef").val().replace(/^\s+|\s+$/g,"");if(proc.indexOf(" ")>0){window.open("index.php?a=editor")}else{window.open("index.php?a=editor&proc="+proc)}}function RemoveFromGroup(User,auth){if(confirm(sprintf(mydbr_loc["MYDBR_GROUP_REM_USER"],User))){document.forms["admin"].usertoberemoved.value=User;document.forms["admin"].usertoberemovedauth.value=auth;document.forms["admin"].actiontype.value="removeuser";document.forms["admin"].app.value="groups";document.forms["admin"].validationRoutine.value="groups_v";document.forms["admin"].submit()}}function ParameterActionCancel(){document.forms["admin"].parametername.value="";document.forms["admin"].paramold.value=name;document.forms["admin"].actiontype.value="addparameter";document.forms["admin"].parameterdef.value="";document.forms["admin"].parametername.disabled=false;$(".pquery_set input[type=checkbox]").prop("checked",false);toggleEdit(0,"parameter")}function StyleActionCancel(){document.forms["admin"].stylename.value="";document.forms["admin"].styleold.value="";document.getElementById("columnstyle").checked=true;document.getElementById("rowstyle").checked=false;document.forms["admin"].styledef.value="";document.forms["admin"].stylename.disabled=false;toggleEdit(0,"style")}function GroupActionCancel(){toggleEdit(0,"group");document.forms["admin"].groupid.value="";document.forms["admin"].groupname.value="";document.forms["admin"].app.value="groups";document.forms["admin"].submit()}function UserAddSelected(tableID){var tbd=new Array,tbd_id=new Array,vTable,iRowCnt,iRow,cb;vTable=document.getElementById(tableID);iRowCnt=vTable.getElementsByTagName("tr").length;for(iRow=1;iRow<iRowCnt;iRow++){cb=document.getElementById(tableID+"cb"+iRow);if(cb){if(cb.checked){tbd.push(vTable.rows[iRow].cells[1].innerHTML);tbd_id.push(vTable.rows[iRow].cells[4].innerHTML)}}}document.forms["admin"].tobeadded.value=tbd.join(",");document.forms["admin"].tobeaddedid.value=tbd_id.join(",");if(document.forms["admin"].tobeadded.value==""){alert("No rows selected");return false}else{document.forms["admin"].actiontype.value="addselectedusers";document.forms["admin"].app.value="groups";document.forms["admin"].validationRoutine.value="groups_v";document.forms["admin"].submit();return true}}function trim(str){return str.replace(/^\s+|\s+$/g,"")}function Users(id,uid,auth){var user,infoerror=false,pw,pwok;if(auth===undefined){auth=2}pw=$("[name=password]").val();if(id!=3){if(pw!=""){if(pw!=$("[name=passwordC]").val()){alert(mydbr_loc["MYDBR_APASSWORD_NOMATCH"]);return false}if(!$("[name=isadmin]").is(":checked")){pwok=Pw_RulesCheck(pw,$("#pwm").val(),$("#pwl").val(),$("#pwn").val(),$("#pws").val());if(!pwok){return false}}}}if(uid==""){user=trim($("[name=login]").val())}else{user=uid}if(id!=0&&user==""){infoerror=true}if((id==1||id==2)&&trim($("[name=username]").val())==""){infoerror=true}if(infoerror){alert("Please enter the Login info.");return false}if(id!=3){pw=$("[name=password]").val();if(pw!=""){if($("#salted_hash").val()=="1"){pw=pw}else{pw=hex_md5(unescape(encodeURIComponent(pw)))}}}$.ajax({url:"apps/user.php",type:"post",async:false,data:{id:id,login:user,username:$("[name=username]").val(),password:pw,isadmin:$("[name=isadmin]").is(":checked")?1:0,email:$("[name=email]").val(),telephone:$("[name=telephone]").val(),authentication:auth,askpwchange:$("[name=askpwchange]").is(":checked")?1:0,csrf_token:csrf_token_get()},success:function(data){if(id==1||id==2){var ug=[],gs;$("[name=useringroup]:checked").each(function(){ug.push($(this).attr("data-id"))});gs=ug.join(",");$.ajax({url:"apps/user_groups_set.php",type:"post",async:false,data:{login:user,authentication:auth,csrf_token:csrf_token_get(),groups:gs}})}$("#users").html(data);UserCancel()},error:function(){alert("An error occurred during query")}});return true}function UserCancel(){toggleEdit(0,"user");$("[name=login]").attr("readonly","readonly").val("");$("[name=username]").val("");$("[name=email]").val("");$("[name=telephone]").val("");$("[name=password]").val("");$("[name=passwordC]").val("");$("[name=isadmin]").attr("checked",false);$("#passhlp").css("display","none")}function user_get_groups(login,auth,target){if(target===undefined){target=".user_groups"}$.ajax({url:"apps/user_groups.php",async:false,type:"get",data:{login:login,authentication:auth},success:function(data){$(target).html(data)}})}function resize_user_group_in_dialog(dlg){var w=$(dlg).width(),h=$(dlg).height(),ug=$(dlg).find(".user_groups"),ug_width,ug_height;ug_width=$(dlg).width()-$(ug).position().left-16;resize_user_group_table(dlg,ug_width,$(dlg).height()-80)}function user_show_groups(item){user_get_groups(getTableCell(item,0),getTableCell(item,10),".user_groups_no_edit");$(".user_groups_no_edit input").on("change",function(){var ug=[],gs,user=getTableCell(item,0),auth=getTableCell(item,10);$("[name=useringroup]:checked").each(function(){ug.push($(this).attr("data-id"))});gs=ug.join(",");$.ajax({url:"apps/user_groups_set.php",type:"post",async:false,data:{login:user,authentication:auth,csrf_token:csrf_token_get(),groups:gs}})});$(".user_groups_no_edit").attr("title",getTableCell(item,1)).dialog({modal:true,width:"auto",height:300,resize:function(event,ui){var w=23,h=80;resize_user_group_table(this,ui.size.width-w,ui.size.height-h)}})}function resize_user_group_table(parent,w,h){$(parent).find(".scrollheader").width(w);$(parent).find(".scroll_content_outer").width(w-2);$(parent).find(".scroll_content").width(w);$(parent).find(".scroll_content_outer").height(h);$(parent).find(".scroll_content").height(h)}function UserEdit(item){user_get_groups(getTableCell(item,0),getTableCell(item,10));$("[name=login]").val(getTableCell(item,0));$("[name=username]").val(getTableCell(item,1));$("[name=email]").val(getTableCell(item,3));$("[name=telephone]").val(getTableCell(item,4));$("#passhlp").css("display","inline");$("[name=isadmin]").prop("checked",getTableCell(item,9)==1?true:false);$("[name=askpwchange]").prop("checked",false);toggleEdit(1,"user");$("[name=login]").attr("readonly","readonly");$("#usern").focus()}function UserDelete(item){if(confirm(sprintf(mydbr_loc["MYDBR_USER_REM"],getTableCell(item,0)))){Users(3,getTableCell(item,0),getTableCell(item,10))}}function ImgSel(){if(document.forms["admin"].imagechart.checked){document.forms["admin"].image_preferred_1.disabled=false}else{document.forms["admin"].image_preferred_0.checked=true;document.forms["admin"].image_preferred_1.checked=false;document.forms["admin"].image_preferred_1.disabled=true}}