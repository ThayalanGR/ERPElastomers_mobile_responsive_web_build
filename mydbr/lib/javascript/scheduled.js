$(document).ready(function(){if(jQuery().tablesorter){$("table.sortable").tablesorter({widgets:["zebra"]})}$("#cron_info").click(function(){$("#cron_info_txt").toggle(300);return false});var options={height:"auto",width:"auto",modal:true,resizable:false};$(".i_edit").click(function(){$('input[name="action"]').val("upd");move_name(this,"cron",0);Cron.set($("#cron").val());Cron.update();move_name(this,"description",1);move_name(this,"url",2);move_name(this,"disabled",5);move_name(this,"id",6);$(".add").hide();$(".update").show();options.title=mydbr_loc.MYDBR_SCHEDULED_UPDATE;$("#scheduled_dialog").dialog(options)});$(".addnew").click(function(){Cron.set("0 1 * * *");$('input[name="url"]').val("");$('input[name="id"]').val("");$('textarea[name="description"]').val("");$('input[name="disabled"]').prop("checked",false);$(".update").hide();$(".add").show();options.title=mydbr_loc.MYDBR_SCHEDULED_ADD;$("#scheduled_dialog").dialog(options)});$(".add, .update").click(function(e){if($("#cron").val()==""||$('input[name="url"]').val()==""){alert("Check the timing and the URL");e.preventDefault()}});$(".i_delete").click(function(){if(confirm(sprintf(mydbr_loc["MYDBR_SCHEDULED_DELETE"],getTableCell(this,0)))){$('input[name="action"]').val("delete");move_name(this,"id",6);$("#dialog_form").submit()}});$("td.url_col").click(function(){var match,url=$(this).text(),base,id;match=url.match(/(.*)report\.php\?r=(\d+)\&/);if(match.length===3){base=match[1];id=match[2];$.ajax({url:"lib/report_location.php",type:"get",data:{id:id},success:function(data){if(data){window.open(base+"/index.php?m="+data+"&highlight="+id)}}})}});$(".cron_field").on("focus",function(e){var id=$(this).attr("data-id");$(".separators .selected").hide();$(".separators .selected."+id).show()});$("#info .fields .clickable").on("click",function(e){var id=$(this).attr("data-id");$("#cron_"+id).focus()});$(".cron_field").on("input",function(e){Cron.update()});if($(".cron_field").length>0){Cron.update()}});function move_name(obj,name,index){var flag,$o=$('input[name="'+name+'"]');if($o.length==0){$o=$('textarea[name="'+name+'"]')}if($o.attr("type")=="checkbox"){$o.prop("checked",getTableCell(obj,index)==1)}else{$o.val(getTableCell(obj,index))}}var Cron={get:function(){var v,c="";for(var i=1;i<6;i++){v=$("#cron_f"+i).val();v=v.replace(/\s+/g,"");c+=(i>1?" ":"")+(v==""?"*":v)}return c},set:function(s){var fields=s.split(" ");for(var i=0;i<fields.length;i++){$("#cron_f"+(i+1)).val(fields[i])}$("#cron").val(s)},update:function(){var txt,next,p,cron=Cron.get();txt="<q>"+prettyCron.toString(cron,false)+"</q>";later.date.localTime();p=later.parse.cron(cron,false);$("#cron").val("");$.ajax({url:"lib/cron.php",type:"get",data:{next:cron},success:function(data){var d=JSON.parse(data);if(d.error==0){txt+='<div class="next">Next: '+new Date(d.next).toLocaleString()+"</div>";$("#explain").html(txt);$("#cron").val(cron)}else{$("#explain").html(d.message)}}})}};