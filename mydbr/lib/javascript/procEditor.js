var divs_timeout,divs_words=[],resultwindow;$(document).ready(function(){var mode,keyc,ctrlKey,resize_on;if($("#db_vendor").val()=="mysql"){mode="text/x-mysql"}else{mode="text/x-mssql"}ctrlKey=/Mac/.test(navigator.platform)?"Cmd":"Ctrl";window.editor=CodeMirror.fromTextArea(document.getElementById("code"),{mode:mode,styleActiveLine:true,autoCloseBrackets:true,matchBrackets:true,indentWithTabs:!editor_prefs.indent_with_space,smartIndent:false,lineNumbers:true,autofocus:true,indentUnit:2,keyMap:editor_prefs.keymap,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],fold:"indent",foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.indent,CodeMirror.fold.comment)},extraKeys:{"Ctrl-Space":"autocomplete","Shift-Tab":editor_prefs.indent_with_space?"indentLess":null,"Ctrl-Q":function(cm){cm.foldCode(cm.getCursor())},Tab:editor_prefs.indent_with_space?"indentMore":null,Esc:function(cm){if(cm.getOption("fullScreen"))cm.setOption("fullScreen",false)}},theme:editor_prefs.theme});editor.options.extraKeys[ctrlKey+"-E"]=executeSQL;editor.options.extraKeys[ctrlKey+"-S"]=function(cm){if(isIE())return;window.open("data:text/plain;charset=utf-8,"+encodeURIComponent(cm.getValue()))};editor.options.extraKeys[ctrlKey+"-G"]=function(cm){editor_search_find_do(event)};editor.options.extraKeys[ctrlKey+"-E"]=executeSQL;editor.options.extraKeys[ctrlKey+"-F"]=editor_search_find;editor.options.extraKeys[ctrlKey+"-Alt-G"]=editor_gotoline;editor.options.extraKeys[ctrlKey+"-Alt-F"]=editor_search_find;editor.options.extraKeys["Shift-"+ctrlKey+"-G"]=function(cm){editor_search_find_do(event)};function is_mydbr_cmd_token(token,e){var is_period=e===undefined?false:(e.keyCode?e.keyCode:e.charCode)==46?true:false;return(token.string.substr(0,1)=='"'||token.string.substr(0,1)=="'")&&(token.string.substr(1,4)==="dbr."||token.string.substr(1,3)==="dbr"&&is_period)}if(editor_prefs.autocomplete_mydbr){window.editor.on("keypress",function(cm,event){var token=cm.getTokenAt(cm.getCursor());if($(".CodeMirror-hint-active").length==0){if(is_mydbr_cmd_token(token,event)){CodeMirror.showHint(cm,CodeMirror.hint.mydbr)}}})}CodeMirror.registerHelper("hint","mydbr",function(editor,options){var cur=editor.getCursor(),result=[],token=editor.getTokenAt(cur),start,end,i;if(token.end>cur.ch){token.end=cur.ch;token.string=token.string.slice(0,cur.ch-token.start)}start=end=cur.ch;start=start-token.string.length+5;for(i=0;i<mydbr_cmds.length;i++){if(token.string.substring(1)==mydbr_cmds[i].substring(0,token.string.length-1)){result.push(mydbr_cmds[i].substr(4))}}return{list:result.sort(),from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)}});CodeMirror.commands.autocomplete=function(cm){var token=cm.getTokenAt(cm.getCursor());if(is_mydbr_cmd_token(token)){CodeMirror.showHint(cm,CodeMirror.hint.mydbr)}else{CodeMirror.showHint(cm,CodeMirror.hint.sql)}};function insertmyDBRCmd(){var is_mysql=editor.options.mode=="text/x-mysql";insertAtCaret("select 'dbr.'"+(is_mysql?";":""));editor.execCommand("goCharLeft");if(is_mysql){editor.execCommand("goCharLeft")}if(editor_prefs.autocomplete_mydbr){CodeMirror.showHint(editor,CodeMirror.hint.mydbr)}}if(editor_prefs.keymap==="sublime"){editor.options.extraKeys["Ctrl-Alt-M"]=function(cm){insertmyDBRCmd()}}else{editor.options.extraKeys["Ctrl-M"]=function(cm){insertmyDBRCmd()}}$(".shortcut").each(function(){if($(this).val()!==""){var sc=$(this);editor.options.extraKeys[$(this).val()]=function(cm){cr=parseInt(sc.closest(".snippet").attr("data-right"),10);cd=parseInt(sc.closest(".snippet").attr("data-down"),10);insertAndIndent(sc.siblings(".code").attr("data-code"),cr,cd)}}});for(keyc in window.editor_prefs.macros){editor.options.extraKeys[keyc]=function(cm){var keyc="";if(event.ctrlKey){keyc+="Ctrl-"}if(event.altKey){keyc+="Alt-"}keyc+=String.fromCharCode(event.keyCode).toUpperCase();lines=window.editor_prefs.macros[keyc].code.split("\n");for(i=0;i<lines.length;i++){insertAtCaret(lines[i]);if(i<lines.length-1){cm.execCommand("newlineAndIndent")}}for(afterc in window.editor_prefs.macros[keyc].after){cm.execCommand(window.editor_prefs.macros[keyc].after[afterc])}}}window.buffers={};buffers["0"]=editor_tab_init();buffers["1"]=editor_tab_init();buffers["2"]=editor_tab_init();buffers["0"].text=$("#q0").text();buffers["2"].text=$("#q2").text();table_hints(window.editor_prefs.autocomplete_db);resize_codemirror(0);resize_on=true;$(window).resize(function(){if(resize_on){resize_codemirror(1)}});$(document).on("click","#db_autocomplete div div",function(){var c=$(this).parent().find(".cm").text();if(c==String.fromCharCode(160)){c="&#10003;";$(this).parent().find(".db").addClass("adb")}else{c="&nbsp;";$(this).parent().find(".db").removeClass("adb")}$(this).parent().find(".cm").html(c)});$(document).on("click","#editor_keyboard",function(){$("#keyboard_shortcuts").dialog({})});$(document).on("click","#snippets_show",function(){var c,name,sel=editor.getSelection();if(sel==""){$("#snippets").dialog({height:525,width:525,minWidth:525,minHeight:253,close:function(event,ui){editor.focus()}})}else{name=window.prompt(mydbr_loc.MYDBR_SQLEDIT_SNIPPET_NEW);if(name){$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"save",id:0,name:name,code:sel,csrf_token:csrf_token_get()},success:function(data){$("#snippets").html(data);SyntaxHighlighter.highlight();editor.setSelection(editor.getCursor())}})}}});$(document).on("keydown",".snippet .shortcut",function(obj){var keycode,s,p,props={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};if(!props.hasOwnProperty(obj.keyCode)){keycode=obj.keyCode;s=get_editor_keycode(obj);if(keycode>=65&&keycode<=90||keycode==8){p=$(this).val();if(p!=""){delete editor.options.extraKeys[$(this).val()]}if(keycode==8){$(this).val("")}else{$(this).val(s);editor.options.extraKeys[s]=function(cm){$(".shortcut").each(function(){if($(this).val()==s){insertAndIndent($(this).siblings(".code").attr("data-code"))}})}}$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"shortcut",id:$(this).closest(".snippet").attr("data-id"),shortcut:s,csrf_token:csrf_token_get()}})}}return false});$(document).on("click",".flip-container .back .hide_move",function(e){$(this).closest(".flip-container").removeClass("flip")});$(document).on("click",".flip-container .back .save_move",function(e){var id,snippet=$(this).closest(".snippet");id=snippet.attr("data-id");$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"save_move",id:id,right:$(this).closest(".back").find('[name="right"]').val(),down:$(this).closest(".back").find('[name="down"]').val(),csrf_token:csrf_token_get()},success:function(data){$("#snippets").html(data);SyntaxHighlighter.highlight()}})});var snippet_click_time=0;$(document).on("click",".snippet .code",function(e){var d=new Date,nd=d.getTime(),cr,cd;if(snippet_click_time+250<nd){cr=parseInt($(this).closest(".snippet").attr("data-right"),10);cd=parseInt($(this).closest(".snippet").attr("data-down"),10);snippet_click_time=nd;insertAndIndent($(this).closest(".code.noselect").attr("data-code"),cr,cd,e);editor.focus()}});$(document).on("click",".flip-container .move_cursor",function(e){$(this).closest(".flip-container").addClass("flip");return false});$(document).on("click",".snippet .close",function(){var id,snippet=$(this).closest(".snippet");id=snippet.attr("data-id");if(window.confirm(mydbr_loc.MYDBR_SQLEDIT_SNIPPET_DELETE+" '"+snippet.find(".name").text()+"'?")){$.ajax({url:"apps_v/snippets_v.php",type:"post",data:{action:"delete",id:id,csrf_token:csrf_token_get()},success:function(data){$("#snippets").html(data);SyntaxHighlighter.highlight()}})}return false});$(document).on("click","#editor_prefs",function(){$("#db_autocomplete").height(115);$("#db_autocomplete_scrollout").height(117);$("#prefs").dialog({autoOpen:true,height:360,width:500,maxWidth:500,minWidth:500,minHeight:253,buttons:{OK:function(){var ok_button,indent_with_spaces,keymap,theme,adbs,adb=[];$("#db_autocomplete .adb").each(function(){adb.push($(this).text())});ok_button=this;adbs=JSON.stringify(adb);theme=$("#theme_select").val();keymap=$("#editor_keymap").val();indent_with_spaces=$("#indent_with_spaces").prop("checked")?1:0;$.ajax({url:"apps_v/editor_prefs.php",type:"post",data:{adbs:adbs,theme:theme,keymap:keymap,indent_with_spaces:indent_with_spaces,csrf_token:csrf_token_get()},success:function(){$(ok_button).dialog("close")}})}},resize:function(event,ui){$("#db_autocomplete").height($(this).height()-120);$("#db_autocomplete_scrollout").height($(this).height()-118)}})});$(document).on("click","#new_document",function(){editor_tab_new()});$(document).on("click","#save",function(){window.open("data:text/plain;charset=utf-8,"+encodeURIComponent(window.editor.getValue()))});$(document).on("click","#search",function(e){editor_search_find()});$(document).on("click","#word_wrap",function(){window.editor.setOption("lineWrapping",!window.editor.getOption("lineWrapping"))});$(document).on("click","#fullscreen",function(){window.editor.setOption("fullScreen",!window.editor.getOption("fullScreen"))});$(document).on("click","#tab_browsing_list div.tab",function(){editor_tab_select($(this).closest("li"))});$(document).on("click","#tab_browsing_list div.close",function(){editor_tab_close($(this).closest("li"))});$(".CodeMirror").resizable({handles:"s",start:function(){resize_on=false},stop:function(){resize_on=true},resize:function(){editor.setSize("100%",$(this).height());editor.space_below=$(window).height()-$(".CodeMirror").height()-$(".CodeMirror").offset().top}});$("#show_obj").click(function(){getObject()});$("#browser").click(function(){$("#sqleditor").slideToggle(300,function(){resize_codemirror(1)});swap_value(this,mydbr_loc.MYDBR_EDITREPORT_SHOW_QUERY_BUILDER,mydbr_loc.MYDBR_EDITREPORT_HIDE_QUERY_BUILDER);return false});$("#comment").click(function(e){comment_code(parseInt($(this).attr("data-dashes"),10),e.altKey);return false});$("#cmdbrowser").click(function(){$("#cmds").slideToggle(300,function(){resize_codemirror(1)});swap_value(this,mydbr_loc.MYDBR_EDITREPORT_SHOW_CMDS,mydbr_loc.MYDBR_EDITREPORT_HIDE_CMDS);if($("#cmds").is(":visible")&&$("#catcmd").children().length==0){$("#category div.tblrow").first().trigger("click")}return false});$("#exe_sql").click(function(){executeSQL()});$("#db div.tblrow").click(function(){get_tables(this);return false});$("#gensql").click(function(){gensql(false);return false});$("#gensqln").click(function(){gensql(true);return false});$("#inscmd").click(function(){insert_command();return false});$("#qsel").sortable();$("#category div.tblrow").click(function(){showcommands(this);return false});$("#table_scrollout").resizable({alsoResize:"#table_scroll,#table_scrollout,#table",handles:"e,w"});$("#recover").click(function(){recover_proc()});$(document).on("dblclick",".recover_proc td",function(){recover_item(this,"proc")});$(document).on("dblclick",".recover_cmd td",function(){recover_item(this,"cmd")});$(".proc_editor_result").click(function(){$.scrollTo($("#editor_result"),400,{easing:"easeInOutCubic"})});$(document).on("change","#theme_select",function(){window.editor.setOption("theme",$(this).val())})});function get_editor_keycode(e){s="";if(e.shiftKey){s+="Shift-"}if(e.ctrlKey){s+="Ctrl-"}if(e.metaKey){s+="Cmd-"}if(e.altKey){s+="Alt-"}s+=String.fromCharCode(e.keyCode);return s}function insertAndIndent(txt,cright,cdown,e){var do_before=e===undefined||!e.altKey,t,c,before,after,lines=txt.replace(/\\n/g,String.fromCharCode(10)).split("\n");if(cright===undefined){cright=0}if(cdown===undefined){cdown=0}c=editor.getCursor();before=editor.getLine(c.line).substr(0,c.ch);before=before.replace(/[^\s]/g," ");t="";for(var i=0;i<lines.length;i++){if(i>0&&do_before){t+=before}t+=lines[i];if(i<lines.length-1){t+="\n"}}insertAtCaret(t);editor.setCursor(c);while(cdown>0){editor.execCommand("goLineDown");cdown--}while(cright>0){editor.execCommand("goColumnRight");cright--}}function insertmyDBRCmd(){var is_mysql=editor.options.mode=="text/x-mysql";insertAtCaret("select 'dbr.'"+(is_mysql?";":""));editor.execCommand("goCharLeft");if(is_mysql){editor.execCommand("goCharLeft")}}function table_hints(db){if(db.length){$.getJSON("apps/editor_hints.php",{db:JSON.stringify(db)},function(data){editor.options.hintOptions=data})}}function recover_proc(){$.ajax({url:"apps/recover.php",type:"get",success:function(data){$("#recover_dialog").html(data).dialog({width:"auto",resizable:false})}})}function recover_item(td,type){var tr=$(td).closest("tr");$.ajax({url:"apps/recover_proc.php",type:"get",data:{id:tr.attr("data-recover_id"),type:type},success:function(data){var title;if(type=="proc"){title=tr.find("td:eq(0)").text()+" - "+tr.find("td:eq(1)").text()}else{title=tr.find("td:eq(0)").text()}editor_tab_new(title,data)}})}function getSelectedText(allIfEmptySelection){var text=window.editor.getSelection();if(text===""&&allIfEmptySelection){text=window.editor.getValue()}return text}function comment_code(dash_th,alt_key){var i,lc,sc,lines,tc,t=window.editor.getSelection(),starts_in_line,rm_last=false,do_dash,f_last_lf_removed,sel;lines=t.split("\n");lc=true;tc="";sc="";sel=editor.listSelections();starts_in_line=sel[0].anchor.ch==0||sel[0].head.ch==0;if(lines[lines.length-1]==""){lines.pop();rm_last=true}for(i=0;i<lines.length;i++){if(lines[i]==""){sc+="\n";tc+="\n"}else{if(lines[i].substr(0,3)!=="-- "){if(lines[i]!==""){lc=false}sc+=(lines[i]!==""?"-- ":"")+lines[i]+"\n"}else{tc+=lines[i].substr(3)+"\n"}}}if(!starts_in_line){lc=false}if(lc){if(!rm_last&&tc.substr(-1)=="\n"){tc=tc.substr(0,tc.length-1)}editor.replaceSelection(tc);return}if($.trim(t).substr(0,2)=="/*"&&$.trim(t).substr(-2)=="*/"){if(t.substr(3,1)=="\n"){i=1}else{i=0}f_last_lf_removed=t.substr(-1)=="\n"&&lines.length==1;t=$.trim(t);t=t.substr(2+i).substr(0,t.length-4-i);if(t.substr(0,1)=="\n"){t=t.substr(1)}if(!starts_in_line&&t.substr(0,1)==" "&&t.substr(-1)==" "){t=t.substr(1).substr(0,t.length-2)}if(lines.length==1){if(t.substr(0,1)==" "){t=t.substr(1)}if(t.substr(-1)==" "){t=t.substr(0,t.length-1)}}editor.replaceSelection(t+(f_last_lf_removed?"\n":""))}else{do_dash=lines.length<=dash_th;if(alt_key)do_dash=!do_dash;if(do_dash&&starts_in_line){if(!rm_last&&sc.substr(-1)=="\n"){sc=sc.substr(0,sc.length-1)}editor.replaceSelection(sc);return}f_last_lf_removed=false;if(t.substr(-1)=="\n"){t=t.substr(0,t.length-1);f_last_lf_removed=true}if(lines.length>1){editor.replaceSelection("/*\n"+t+"\n*/\n")}else{editor.replaceSelection("/* "+t+" */"+(f_last_lf_removed?"\n":""))}}}function swap_value(obj,str1,str2){obj.value=obj.value==str1?str2:str1}function insert_command(){var cmd_end,cmd;if($("#catcmd .selected").length>0){cmd_end=$("#db_vendor").val()=="mysql"?";":"";cmd=$($("#catcmd .selected").children()[2]).text()+cmd_end+"\n";insertAtCaret(cmd)}else{alert("Please select the command to be inserted.")}}function showcommands(obj){$(obj).parent().children().each(function(){$(this).removeClass("selected")});$(obj).addClass("selected");var cat=$($(obj).children()[1]).text();$.ajax({url:"apps/cmdhelper.php",type:"get",data:{cmdhelp:cat},success:function(data){$("#catcmd").html(data);$("#catcmd div.tblrow").click(function(){select_command(this)});$("#catcmd div.tblrow").dblclick(function(){dblclick_command(this)})}})}function dblclick_command(obj){select_command(obj);insert_command()}function select_command(obj){$(obj).parent().children().each(function(){$(this).removeClass("selected")});$(obj).addClass("selected")}function search_divtable(phrase,table,event){var kc=event.keyCode,words=phrase.value.toLowerCase().split(" "),elem,i,displayStyle;clearTimeout(divs_timeout);divs_timeout=setTimeout(function(){do_divsearch(kc)},600);function do_divsearch(kcode){var skipthese=[9,16];if(array_identical(words,divs_words)||$.inArray(kcode,skipthese)>=0){return}divs_words=words;$("#"+table).children().each(function(){elem=$(this).text().replace(/<[^>]+>/g,"");displayStyle="none";for(i=0;i<words.length;i++){if(elem.toLowerCase().indexOf(words[i])>=0)displayStyle="";else{displayStyle="none";break}}$(this).css("display",displayStyle)})}}function insertAtCaret(myValue){var p=editor.getCursor();editor.replaceRange(myValue,CodeMirror.Pos(p.line,p.ch))}function get_tables(obj){$(obj).parent().children().each(function(){$(this).removeClass("selected")});$(obj).addClass("selected");var db=$($(obj).children()[0]).text();$.ajax({url:"apps_v/sqleditor_v.php",type:"get",data:{type:"db",object:db,object_sub:""},success:function(data){$("#table").html(data);$("#table div.tblrow").click(function(){var obj_type=$(this).children(":last").text();get_columns(this,$(this).children(":first").text(),obj_type,"s")});$("#table div.tblrow").dblclick(function(){var obj_type=$(this).children(":last").text();get_columns(this,$(this).children(":first").text(),obj_type,"d")});get_columns(null,"","","")}})}function column_title(col1,col2){$(".col_hdr").html(col1);$(".dt_hdr").html(col2)}function get_report(db,db_obj){$.ajax({url:"apps_v/sqleditor_v.php",type:"get",data:{type:"P",object:db,object_sub:db_obj},success:function(data){$("#column").html(data);if(data!=""){column_title(mydbr_loc.MYDBR_SQLEDIT_REPORT,"")}else{column_title(mydbr_loc.MYDBR_SQLEDIT_ROUTINE,"")}}})}function get_columns(obj,db_obj,obj_type,click){$(obj).parent().children().each(function(){$(this).removeClass("selected")});$(obj).addClass("selected");var db=$($("#db .selected").children()[0]).text();if(db_obj==""||db==""){$("#column").html("");column_title(mydbr_loc.MYDBR_SQLEDIT_COLUMN,mydbr_loc.MYDBR_SQLEDIT_DATATYPE);return}if(click=="d"&&obj_type!="T"){if(obj_type=="P"){get_report(db,db_obj)}edit_obj(db_obj,db);return}if(click=="s"&&obj_type!="T"){if(obj_type=="P"){get_report(db,db_obj)}return}$.ajax({url:"apps_v/sqleditor_v.php",type:"get",data:{type:obj_type,object:db,object_sub:db_obj},success:function(data){$("#column").html(data);column_title(mydbr_loc.MYDBR_SQLEDIT_COLUMN,mydbr_loc.MYDBR_SQLEDIT_DATATYPE);$("#column div.tblrow").click(function(){get_select(this,$(this).children(":first").text())})}})}function get_select(obj,column){var db,table,aggr,aggrall;$(obj).parent().children().each(function(){$(this).removeClass("selected")});$(obj).addClass("selected");db=$($("#db .selected").children()[0]).text();table=$($("#table .selected").children()[0]).text();if(column=="*"){aggrall=""}else{aggrall='<option value="sum">sum</option>'+'<option value="min">min</option>'+'<option value="max">max</option>'+'<option value="avg">avg</option>'}aggr="<select>"+'<option value="none" selected="selected">None</option>'+aggrall+'<option value="count">count</option>'+"</select>";if(!sel_exist(db,table,column)){$("#qsel").append('<div class="tblrow"><div class="col_sel_db">'+db+'</div><div title="'+table+'" class="col_sel_table">'+table+'</div><div title="'+column+'" class="col_sel_col">'+column+'</div><div class="col_sel_aggr">'+aggr+'</div><div class="col_sel_del"><div class="i_delete">&nbsp;</div></div></div>');$("#qsel").children(":last").children(":last").click(function(){$(this).parent().remove()})}}function sel_exist(db,table,column){var selection_exists=false;$("#qsel").children().each(function(){var sel_db,sel_table,sel_column;sel_db=$($(this).children()[0]).text();sel_table=$($(this).children()[1]).text();sel_column=$($(this).children()[2]).text();if(sel_db==db&&sel_table==table&&sel_column==column){selection_exists=true;$(this).effect("highlight",{},500)}});return selection_exists}function gensql(newtab){var par=new Array;$("#qsel").children().each(function(){var row=$(this).children();par.push(new Array($(row[0]).text(),$(row[1]).text(),$(row[2]).text(),$($($(row[3]).children())[0]).val()))});if(par.length<1){alert("Please select the columns first.");return}$.ajax({url:"apps/gen_sql.php",type:"post",data:{query:$.toJSON(par)},success:function(data){var placeholder,query;if(newtab){editor_tab_new("Generated",data)}else{placeholder="select \nfrom \nwhere ";query="";if(query.search(placeholder)>0){}else{insertAtCaret(data)}}}})}function executeSQL(){var path,query=getSelectedText(true),newwin=$("#newwin").is(":checked"),output_as_sql=$("#output_as_sql").is(":checked");if(newwin&&(!resultwindow||!resultwindow.open)){path=location.href.substring(0,location.href.lastIndexOf("/")+1);resultwindow=window.open("","Result window","");resultwindow.document.write("<html><head><title>Query result</title>");resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+path+'interface/themes/blue.css">');resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+path+'interface/normal.css">');resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+path+'interface/style.css">');resultwindow.document.write('<link rel="stylesheet" type="text/css" href="'+path+'interface/sqleditor.css">');resultwindow.document.write('<style type="text/css">'+".editor_result td{ border-bottom: 1px solid #CCC; padding: 0.3em 1em}\n"+".editor_result tr:hover td{  background-color: rgb(179, 255, 0); cursor: pointer}\n"+".editor_result th{ background: #CCC } \n"+"body{padding:1em}\n"+"</style>");resultwindow.document.write('</head><body><div id="result"></div></body></html>')}if(newwin)output_as_sql=false;$.ajax({url:"apps_v/procEditor_v.php",type:"post",data:{query:query,newwin:newwin,output_as_sql:output_as_sql,csrf_token:csrf_token_get(),format:"text"},error:function(jqXHR,error,errorThrown){var e,error_txt=$(jqXHR.responseText).text();if(error_txt==""){error_txt=jqXHR.responseText}if(jqXHR.status===0){e="No connect.\n Verify Network."}else if(jqXHR.status==403){e="Permission denied. [403]"}else if(jqXHR.status==404){e="Requested page not found. [404]"}else if(jqXHR.status==500){e="Internal Server Error [500]."}else{e="Error.\n"+jqXHR.status}e+='<pre class="exec_error">'+e+"\n"+error_txt+"</pre>";$("#editor_result").html(e);$(".proc_editor_result").text("Error").addClass("exec_error").css("display","inline-block");$.scrollTo($(".proc_editor_result"),800,{easing:"easeInOutCubic"})},success:function(data){var time,newelem;if(data.substring(0,5)=="ERROR"){output_as_sql=false;data=data.substring(5)}if(output_as_sql){editor_tab_new("SQL",data)}else if(newwin){newelem=document.createElement("div");newelem.innerHTML=data;resultwindow.document.getElementById("result").appendChild(newelem);if(resultwindow.document.body.scrollHeight){resultwindow.scrollTo(0,resultwindow.document.body.scrollHeight)}}else{$("#editor_result").html(data);time=$(".querytime").last().find("span").text();if(time){if($("#editor_result").find(".enote_left").length){$(".proc_editor_result").text(time).addClass("exec_error").css("display","inline-block")}else{$(".proc_editor_result").text(time).removeClass("exec_error").css("display","inline-block")}}else{$(".proc_editor_result").hide()}if($(".procsaved").length){$("#addreport").show()}else{$("#addreport").hide()}}}});return false}function setSelectionRange(input,selectionStart,selectionEnd){if(input.setSelectionRange){input.focus();input.setSelectionRange(selectionStart,selectionEnd)}else if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd("character",selectionEnd);range.moveStart("character",selectionStart);range.select()}}function replaceSelection(input,replaceString){var isCollapsed,range,selectionStart,selectionEnd;if(input.setSelectionRange){selectionStart=input.selectionStart;selectionEnd=input.selectionEnd;input.value=input.value.substring(0,selectionStart)+replaceString+input.value.substring(selectionEnd);if(selectionStart!=selectionEnd){setSelectionRange(input,selectionStart,selectionStart+replaceString.length)}else{setSelectionRange(input,selectionStart+replaceString.length,selectionStart+replaceString.length)}}else if(document.selection){range=document.selection.createRange();if(range.parentElement()==input){isCollapsed=range.text=="";range.text=replaceString;if(!isCollapsed){range.moveStart("character",-replaceString.length);range.select()}}}}function getObject(){var db_obj="";db_obj=getSelectedText();if(db_obj==""){alert(mydbr_loc.MYDBR_SQLEDIT_SELECT_OBJECT);return false}edit_obj(db_obj);return true}function edit_obj(db_obj,db){var cond_db,createtxt,cdown;if(db===undefined){cond_db=""}else{cond_db=db}$.ajax({url:"apps/getobject.php",type:"post",data:{object:db_obj,db:cond_db},success:function(data){if(data!=""){editor_tab_new(db_obj,data)}else{$.ajax({url:"apps/cmdhelper.php",type:"get",data:{cmd:db_obj},success:function(data){if(data!=""){window.open(data)}else{if(db_obj.substr(0,mydbr_report_prefix.length)==mydbr_report_prefix){if(confirm(sprintf(mydbr_loc["MYDBR_SQLEDIT_NO_OBJECT"],db_obj)+mydbr_loc["MYDBR_SQLEDIT_CREATE_IT"])){if($("#db_vendor").val()=="mysql"){createtxt="()"+"\n";cdown=3}else{createtxt="\nas\n";cdown=4}editor_tab_new(db_obj,"create procedure "+db_obj+createtxt+"begin\n\n\n\nend");while(cdown>0){editor.execCommand("goLineDown");cdown--}}}else{alert(sprintf(mydbr_loc["MYDBR_SQLEDIT_NO_OBJECT"],db_obj))}}}})}},error:function(){alert("Unable to search for the object.")}});return true}function scroll(){$("#linenumb")[0].scrollTop=$("#proc_editor")[0].scrollTop}function resize(event,ui){newHeight=$("#proc_editor").height()+parseInt($(this).css("top"),10);$("#proc_editor, #linenumb").height(newHeight);$(this).css("top","0px")}