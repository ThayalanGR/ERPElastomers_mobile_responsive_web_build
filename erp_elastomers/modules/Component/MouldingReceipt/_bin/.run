// ----- Default Functions---------------------------------------------------------------------------------------------------------------- //

isSelectable	=	true;
var objCompList	= 	"";

function updateData(){
	$(".add_button").click(function(){
		planid		=	$(this).attr('planid');
		var planIdArray = new Array();					
		planIdArray.push(planid);		
		updateCont   =   '<table width="100%" >' +
								'<tr><td><b>Are you sure to Update the Plan?</b></td></tr>' +
								'</table>';	
		$('#update_dialog').html(updateCont).dialog({
			title:'Update',
			width:300,
			height:125,
			resizable:false,
			modal:true,
			buttons:{
				'YES':function(){
					updatePlan(planIdArray);
				},
				'NO':function(){
				   $(this).dialog('close');
				}
			},
			close:function(){
				$(this).html('').dialog('destroy');
			}
		});			
	});
	
	$(".delete_button").click(function(){
		planId		=	$(this).attr('planid');
		param		=	"type=DELPLAN&keyid="+planId;
		deleteCont   =   '<table width="100%" >' +
						'<tr><td><b>Are you Sure to Delete ?</b></td></tr>' +
						'</table>';
		$('#delete_dialog').html(deleteCont).dialog({
			title:'Delete',
			width:300,
			height:125,
			resizable:false,
			modal:true,
			buttons:{
				'YES':function(){
					$('#delete_dialog').dialog('close');
					var resultErr       =	postback(actionFile,param,"POST","XML");
					if(resultErr != 'success')
						alert("Deletion of Plan failed due to : " + resultErr);					
					updatePageBehaviour();				
				},
				'NO':function(){
				   $(this).dialog('close');
				}
			},
			close:function(){
				$(this).html('').dialog('destroy');
			}
		});
		
	});
	
	calcGrandTotals();

}

function calcGrandTotals(){
	planliftTot	=	0;
	actliftTot	=	0;
	insQtyTot	=	0;
	actQtyTot	=	0;
	
	$("#content_body table tr").each(function(index, element){
		plTot		=	($(this).find("td:eq(4)").html())? Number($(this).find("td:eq(4)").html().split(",").join("")):0;   
		alTot		=	($(this).find("td:eq(5) input").val())? Number($(this).find("td:eq(5) input").val().split(",").join("")):0;
		iqTot		=	($(this).find("td:eq(6)").html())? Number($(this).find("td:eq(6)").html().split(",").join("")):0;
		acTot		=	($(this).find("td:eq(7)").html())? Number($(this).find("td:eq(7)").html().split(",").join("")):0;
		 
		planliftTot	=	planliftTot	+	(isNaN(plTot)?	0	:	plTot);
		actliftTot	=	actliftTot	+	(isNaN(alTot)?	0	:	alTot);
		insQtyTot	=	insQtyTot	+	(isNaN(iqTot)?	0	:	iqTot); 
		actQtyTot	=	actQtyTot	+	(isNaN(acTot)?	0	:	acTot);
	}); 
	$("#act_lift_total").html(actliftTot.toCurrency()); 
	$("#plan_lift_total").html(planliftTot.toCurrency());
	$("#ins_qty_total").html(insQtyTot.toCurrency()); 
	$("#act_qty_total").html(actQtyTot.toCurrency());
}

function updateLiftChanges(lift){
	actlift 		= 	$(lift).val();
	$(lift).attr('class','');
	planid			=	$(lift).attr('planid');
	noOfCavs		=	$('#label_'+planid).attr('noofCavs');
	newActQty		=	actlift.toNumber() * noOfCavs.toNumber();
	$('#label_'+planid).html(newActQty.toCurrency());
	calcGrandTotals();

}


$(document).ready(function(){
	updatePageBehaviour();
	
	$("#button_submit").button().click(function(){
		var inputs = $("#content_body").find(":input");
		if(inputs.length > 0)
		{
			updateCont   =   '<table width="100%" >' +
									'<tr><td><b>Are you Sure to Update the Plan?</b></td></tr>' +
									'</table>';	
			$('#update_dialog').html(updateCont).dialog({
				title:'Update',
				width:300,
				height:125,
				resizable:false,
				modal:true,
				buttons:{
					'YES':function(){
						var planIdArray = new Array();					
						$("#content_body table tr").each(function(index, element){
							planid		=	$(this).find("td:eq(5) input").attr('planid');
							planIdArray.push(planid);
						}); 
						updatePlan(planIdArray);
					},
					'NO':function(){
					   $(this).dialog('close');
					}
				},
				close:function(){
					$(this).html('').dialog('destroy');
				}
			});	
		}
		else
		{			
			alert(" No Items to be updated!!!");
		}

	});
	
	$("#button_cancel").button().click(function(){
		var inputs = $("#content_body").find(":input");
		if(inputs.length > 0)
		{
			updateCont   =   '<table width="100%" >' +
									'<tr><td><b>Are you Sure to Clear all the Entries?</b></td></tr>' +
									'</table>';	
			$('#clear_dialog').html(updateCont).dialog({
				title:'Create',
				width:300,
				height:125,
				resizable:false,
				modal:true,
				buttons:{
					'YES':function(){
						$(this).dialog('close');
						updatePageBehaviour();
					},
					'NO':function(){
					   $(this).dialog('close');
					}
				},
				close:function(){
					$(this).html('').dialog('destroy');
				}
			});	
		}
		else
		{				
			alert(" No Items to be cleared!!!");
		}
	});
	
});

function updatePlan(planIdArr){
	param = "";
	for(cnt=0;cnt<planIdArr.length;cnt++)
	{
		planId		= 	planIdArr[cnt];
		actLiftObj	=	$("#input_"+planId);
		if(actLiftObj.val() != null && actLiftObj.val() != "" && actLiftObj.val() != undefined && Number(actLiftObj.val()) > 0 )
		{
			actLifts	=	actLiftObj.val();
			mouldQty	=	$("#label_"+planId).html();
			planQty		=	actLiftObj.attr('plannedqty');
			if(mouldQty.toNumber() <= (planQty.toNumber() * 1.1))
			{
				operator	=	actLiftObj.attr('operator');
				param		+=	"&planref[]="+planId+"&actlifts[]="+actLifts.toNumber()+"&mouldqty[]="+mouldQty.toNumber()+"&operator[]="+operator;		
			}
			else
			{
				alert("Number of Actual Lifts greater than 110% of Planned Lifts,  Please raise new Plan for excess lifts!!!");
				actLifts.focus()
				return false;			
			}
		}
		else
		{
			alert("Please enter proper values for actual Lifts!!!");
			actLifts.focus()
			return false;
		}
	}
	if(param != null && param != "")
	{
		param 		= "type=INSRECEIPT"+param;
		$('#update_dialog').dialog('close');
		resError	= postback(actionFile,param,"GET","XML");
		if(resError == 'success')
			updatePageBehaviour();
		else
			alert(" Update of Plan failed due to " + resError);
	}
}

function updatePageBehaviour(){
	param =  "prodDate="+$("#prodDate").val()+"&operator="+$("#operator").val();
	//alert(param);
	objCompList	= postback(actionFile,param,"GET","XML");
	//alert(objCompList);
	//objCompList		= objCompList.split("&lt;br&gt;").join(" ");
	listPageData($("#content_body"), objCompList, XSLFile);
	updateData();
	updateHeader(); 
	updateContent();
	
}